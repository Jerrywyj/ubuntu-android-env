<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0036)http://www.haogongju.net/art/1002308 -->
<html xmlns="http://www.w3.org/1999/xhtml" version="g42dymwpi--nx">
<body>
    <div id="mainbox">
        
        <div class="haogongju_index">
            <div class="left">
                
                
                <div id="content">
                    <h1>Building from source--想自己编译cyanogenmod ROM吗？</h1>
                    
                    <div id="content_art">
                        
	<div id="column-content"><div id="content"><h1><span class="Apple-style-span" style="font-size: 16px; ">From CyanogenMod Wiki</span></h1><div id="bodyContent">     <h2><span>How do I compile the CyanogenMod <span style="cursor: help">kernel from source</span></span> </h2> <p>The following instructions will enable the build of a CyanogenMod <span style="cursor: help">KERNEL, not the build of the CyanogenMod itself. As a  matter of fact you will download the Google's Android source without the  CyanogenMod modifications. If you want to build the CyanogenMod itself from  source you should look at the following section (2.* of this document) "Building  for Passion/Nexus One". Even if you don't go for these targets it should be a  good help. </span></p> <p><strong>BEWARE! INEXPERIENCED USERS MAY <span style="cursor: help">BRICK THEIR PHONES!</span></strong> </p> <p>These instructions have only been tested for <strong>4.2.10.1</strong> on <strong>25 DEC  2009</strong>. <strong>This information may be out-of-date.</strong> </p> <p>These instructions are for a <strong>Debian/Ubuntu 32bit system</strong>. If you have a  different platform, more information can be found <a text"="" title="http://android.git.kernel.org" href="http://android.git.kernel.org/" target="_blank" rel="nofollow">here</a> and <a text"="" title="http://source.android.com/download" href="http://source.android.com/download" target="_blank" rel="nofollow">here</a>.</p><p>&nbsp;</p><h3>Install CyanogenMod on your Phone </h3> <ol> <li><a title="Main Page" href="http://wiki.cyanogenmod.com/index.php/Main_Page#How_do_I_upgrade_to_the_latest_CyanogenMod" target="_blank" rel="nofollow">Install  CyanogenMod on your phone.</a> </li></ol><br><h3>Take a backup </h3> <p>Better safe than sorry, boot into recovery and take a backup of your working  phone. </p><br><h3>Install Repo </h3> <ol> <li>Install the various tools you will need.<pre><div class="haogongju_code"><div><!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />--><span style="color: #000000;">sudo&nbsp;aptitude&nbsp;install&nbsp;git</span><span style="color: #000000;">-</span><span style="color: #000000;">core&nbsp;gnupg&nbsp;sun</span><span style="color: #000000;">-</span><span style="color: #000000;">java6</span><span style="color: #000000;">-</span><span style="color: #000000;">jdk&nbsp;flex&nbsp;bison&nbsp;gperf&nbsp;libsdl</span><span style="color: #000000;">-</span><span style="color: #000000;">dev&nbsp;libesd0</span><span style="color: #000000;">-</span><span style="color: #000000;">dev&nbsp;libwxgtk2.</span><span style="color: #800080;">6</span><span style="color: #000000;">-</span><span style="color: #000000;">dev&nbsp;build</span><span style="color: #000000;">-</span><span style="color: #000000;">essential&nbsp;zip&nbsp;curl&nbsp;libncurses5</span><span style="color: #000000;">-</span><span style="color: #000000;">dev&nbsp;zlib1g</span><span style="color: #000000;">-</span><span style="color: #000000;">dev</span></div></div><p>&nbsp;</p></pre>And  for 64bit only: <pre><div class="haogongju_code"><div><!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />--><span style="color: #000000;">sudo&nbsp;aptitude&nbsp;install&nbsp;ia32</span><span style="color: #000000;">-</span><span style="color: #000000;">libs&nbsp;lib32z1</span><span style="color: #000000;">-</span><span style="color: #000000;">dev&nbsp;lib32ncurses5</span><span style="color: #000000;">-</span><span style="color: #000000;">dev&nbsp;gcc</span><span style="color: #000000;">-</span><span style="color: #000000;">multilib&nbsp;g</span><span style="color: #000000;">++-</span><span style="color: #000000;">multilib</span></div></div><p>&nbsp;</p></pre> </li><li>Make sure you have a /bin directory in your /home directory<pre><div class="haogongju_code"><div><!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />--><span style="color: #000000;">cd&nbsp;</span><span style="color: #000000;">~/</span><span style="color: #000000;"><br>mkdir&nbsp;bin<br>cd&nbsp;bin<br>echo&nbsp;$PATH</span></div></div><p>&nbsp;</p></pre>You should see something like '...:/home/user_name/bin:...'  in a line of text. If you don't see this, try restarting your computer.  </li><li>Download repo and make it executable<pre><div class="haogongju_code"><div><!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />--><span style="color: #000000;">curl&nbsp;http:</span><span style="color: #008000;">//</span><span style="color: #008000;">android.git.kernel.org/repo&nbsp;&gt;~/bin/repo</span><span style="color: #008000;"><br></span><span style="color: #000000;">chmod&nbsp;a</span><span style="color: #000000;">+</span><span style="color: #000000;">x&nbsp;</span><span style="color: #000000;">~/</span><span style="color: #000000;">bin</span><span style="color: #000000;">/</span><span style="color: #000000;">repo</span></div></div><p>&nbsp;</p></pre> </li><li>Create a directory to hold you working files:<pre><div class="haogongju_code"><div><!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />--><span style="color: #000000;">mkdir&nbsp;</span><span style="color: #000000;">~/</span><span style="color: #000000;">mydroid<br>cd&nbsp;</span><span style="color: #000000;">~/</span><span style="color: #000000;">mydroid</span></div></div><p>&nbsp;</p></pre> </li><li>Download the latest Repo:<pre><div class="haogongju_code"><div><!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />--><span style="color: #000000;">repo&nbsp;init&nbsp;</span><span style="color: #000000;">-</span><span style="color: #000000;">u&nbsp;git:</span><span style="color: #008000;">//</span><span style="color: #008000;">android.git.kernel.org/platform/manifest.git</span></div></div><p>&nbsp;</p></pre>If  everything was successful, you should see a message like 'repo initialized in  /mydroid'  </li><li>Next, get the latest files:<pre><div class="haogongju_code"><div><!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />--><span style="color: #000000;">repo&nbsp;sync</span></div></div><p>&nbsp;</p></pre>This step may take a while.  </li><li>Create an environment variable denoting the location of the android  toolchain as follows:<pre><div class="haogongju_code"><div><!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />--><span style="color: #000000;">export&nbsp;CCOMPILER</span><span style="color: #000000;">=/</span><span style="color: #000000;">home</span><span style="color: #000000;">/</span><span style="color: #000000;">$USER</span><span style="color: #000000;">/</span><span style="color: #000000;">mydroid</span><span style="color: #000000;">/</span><span style="color: #000000;">prebuilt</span><span style="color: #000000;">/</span><span style="color: #000000;">linux</span><span style="color: #000000;">-</span><span style="color: #000000;">x86</span><span style="color: #000000;">/</span><span style="color: #000000;">toolchain</span><span style="color: #000000;">/</span><span style="color: #000000;">arm</span><span style="color: #000000;">-</span><span style="color: #000000;">eabi</span><span style="color: #000000;">-</span><span style="color: #800080;">4.4</span><span style="color: #000000;">.</span><span style="color: #800080;">0</span><span style="color: #000000;">/</span><span style="color: #000000;">bin</span><span style="color: #000000;">/</span><span style="color: #000000;">arm</span><span style="color: #000000;">-</span><span style="color: #000000;">eabi</span><span style="color: #000000;">-</span></div></div><p>&nbsp;</p></pre></li></ol><br><h3><span>Prepare <span style="cursor: help">Kernel From Source</span></span> </h3> <ol> <li>Create a new directory in which to place the <span style="cursor: help">kernel source</span><pre><div class="haogongju_code"><div><!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />--><span style="color: #000000;">mkdir&nbsp;androkern</span></div></div><p>&nbsp;</p></pre> </li><li>Enter the <span style="cursor: help">kernel directory</span><pre><div class="haogongju_code"><div><!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />--><span style="color: #000000;">cd&nbsp;androkern</span></div></div><p>&nbsp;</p></pre> </li><li>Download the <span style="cursor: help">kernel</span><pre><div class="haogongju_code"><div><!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />--><span style="color: #000000;">git&nbsp;clone&nbsp;git:</span><span style="color: #008000;">//</span><span style="color: #008000;">github.com/cyanogen/cm-kernel.git</span></div></div><p>&nbsp;</p></pre> </li><li>Enter the source directory<pre><div class="haogongju_code"><div><!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />--><span style="color: #000000;">cd&nbsp;cm</span><span style="color: #000000;">-</span><span style="color: #000000;">kernel</span></div></div><p>&nbsp;</p></pre> </li><li>Retrieve a <span style="cursor: help">kernel .config file. This can be pulled from the phone  or from a boot.img </span> <ol> <li>Retrieve a working <span style="cursor: help">kernel config from your phone:</span><pre><div class="haogongju_code"><div><!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />--><span style="color: #000000;">adb&nbsp;pull&nbsp;</span><span style="color: #000000;">/</span><span style="color: #000000;">proc</span><span style="color: #000000;">/</span><span style="color: #000000;">config.gz&nbsp;</span><span style="color: #000000;">/</span><span style="color: #000000;">home</span><span style="color: #000000;">/</span><span style="color: #000000;">user_name</span><span style="color: #000000;">/</span><span style="color: #000000;">androkern</span><span style="color: #000000;">/</span><span style="color: #000000;">cm</span><span style="color: #000000;">-</span><span style="color: #000000;">kernel</span><span style="color: #000000;">/</span><span style="color: #000000;">config.gz</span></div></div><p>&nbsp;</p></pre> <ol> <li>Unzip the config.gz and rename it to .config<pre><div class="haogongju_code"><div><!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />--><span style="color: #000000;">gunzip&nbsp;config.gz&nbsp;</span><span style="color: #000000;">&amp;&amp;</span><span style="color: #000000;">&nbsp;mv&nbsp;config&nbsp;.config</span></div></div><p>&nbsp;</p></pre></li></ol> </li><li>Alternatively, you can pull the .config from the newest boot.img  <ol> <li><pre><div class="haogongju_code"><div><!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />--><span style="color: #000000;">scripts</span><span style="color: #000000;">/</span><span style="color: #000000;">extract</span><span style="color: #000000;">-</span><span style="color: #000000;">ikconfig&nbsp;boot.img&nbsp;</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">&nbsp;.config</span></div></div><p>&nbsp;</p></pre></li></ol></li></ol> </li><li>Run<pre><div class="haogongju_code"><div><!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />--><span style="color: #000000;">make&nbsp;ARCH</span><span style="color: #000000;">=</span><span style="color: #000000;">arm&nbsp;CROSS_COMPILE</span><span style="color: #000000;">=</span><span style="color: #000000;">$CCOMPILER&nbsp;oldconfig</span></div></div><p>&nbsp;</p></pre>Provide answers to  the questions it asks, if any, or just keep pressing enter to accept defaults.  </li><li>Customize the <span style="cursor: help">kernel</span><pre><div class="haogongju_code"><div><!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />--><span style="color: #000000;">make&nbsp;ARCH</span><span style="color: #000000;">=</span><span style="color: #000000;">arm&nbsp;CROSS_COMPILE</span><span style="color: #000000;">=</span><span style="color: #000000;">$CCOMPILER&nbsp;menuconfig</span></div></div><p>&nbsp;</p></pre> </li><li>Make the build<pre><div class="haogongju_code"><div><!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />--><span style="color: #000000;">make&nbsp;ARCH</span><span style="color: #000000;">=</span><span style="color: #000000;">arm&nbsp;CROSS_COMPILE</span><span style="color: #000000;">=</span><span style="color: #000000;">$CCOMPILER</span></div></div><p>&nbsp;</p></pre>This step may take from minutes  to hours. </li></ol> <p>At this point you should have a <span style="cursor: help">kernel stored in cm-<span style="cursor: help">kernel</span>/arch/arm/boot/zImage </span></p><br><h3>Build CyanogenMod </h3> <ol> <li><pre>cd ~/mydroid</pre> </li><li><pre>source build/envsetup.sh</pre> </li><li>Now you need choose which product you want to build, You can list all  buildable product with <pre>sed -n -e "s/^add_lunch_combo//gp" vendor/*/vendorsetup.sh</pre> </li><li><pre>lunch cyanogen_dream_us-eng</pre>this load cyanogenmod product  </li><li><pre>make -j4</pre>build process is long... take a pizza, a beer and watch TV.  The -j flag specifies how many threads the compiler should use. Rule of thumb is  # of processors+1 but will vary with who you ask. </li></ol> <p>Next soon. </p><br><h3>Complete the build </h3> <p><span>You need to merge this file with a working cyanogen ramdisk in order to  create a boot image suitable for <span style="cursor: help">flashing</span>. </span></p> <p>Follow these instructions <a text"="" title="http://android-dls.com/wiki/index.php?title=HOWTO:_Unpack%2C_Edit%2C_and_Re-Pack_Boot_Images" href="http://android-dls.com/wiki/index.php?title=HOWTO:_Unpack%2C_Edit%2C_and_Re-Pack_Boot_Images" target="_blank" rel="nofollow">here</a> in order to do so. </p> <p><span>If all goes well, you should now be running your own custom CyanogenMod  <span style="cursor: help">kernel</span> on your phone. </span></p> <p>If you are building for Nexus One then you should use --base 0x20000000 when  running mkbootimg. </p><br><h2>Building for Passion/Nexus One </h2> <p>This will explain how to build CM, using the code from Cyanogen's github  repository. </p><br><h3>Obtaining the code </h3> <p>Read the introduction and how-to on obtaining the source from <a free"="" title="http://source.android.com/" href="http://source.android.com/" target="_blank" rel="nofollow">http://source.android.com/</a>  this is quite similar but won't cover the basics. </p> <p>We use Cyanogens manifest file instead of theirs, it has all the good stuff  in it. </p> <p>Initialize your repository </p> <ol> <li><pre>mkdir ~/android-cm</pre> </li><li><pre>cd ~/android-cm</pre> </li><li><pre>repo init -u git://github.com/cyanogen/android.git -b eclair</pre> </li><li><pre>repo sync</pre></li></ol> <p>The sync can take quite some time, it pulls about 2gig of files. </p><br><h3>Create build environment </h3> <ol> <li><pre>cd ~/android-cm</pre> </li><li><pre>source build/envsetup.sh</pre></li></ol><br><h3><span>Build <span style="cursor: help">ADB (only required if you haven't built it yet)  </span></span></h3> <ol> <li><pre> make -j4 <span style="cursor: help">adb</span></pre></li></ol><br><h3>Configure build </h3> <ol> <li>Now you need choose which product you want to build, You can list all  buildable products with <pre>sed -n -e "s/^add_lunch_combo//gp" vendor/*/vendorsetup.sh</pre> </li><li><pre>lunch cyanogen_passion-userdebug</pre>select a cyanogenmod build type  </li></ol><br><h3>Get proprietary files from your device </h3> <ol> <li><pre> cd ~/android-cm/vendor/google/passion</pre> </li><li><pre> ./extract-files.sh</pre> </li><li><pre> cd -</pre></li></ol><br><h3>Build it </h3> <p>Looks like we're ready to build </p> <ol> <li>start building <pre>make -j4</pre></li></ol> <p>Now this takes from 30 min to 2 hours, depending on your computer. </p>Once  ready, all files will be placed in <pre> ~/android-cm/out/target/product/passion </pre> <p><span>You can now create a <span style="cursor: help">rom or just </span><span style="cursor: help">flash</span> them with <span style="cursor: help">fastboot like this </span></span></p> <ol> <li><pre> cd ~/android-cm/out/target/product/passion</pre> </li><li><pre><span> <span style="cursor: help">fastboot </span><span style="cursor: help">flash</span> system system.img</span></pre> </li><li><pre><span> <span style="cursor: help">fastboot </span><span style="cursor: help">flash</span> boot boot.img</span></pre> </li><li><pre><span> <span style="cursor: help">fastboot </span><span style="cursor: help">flash</span> userdata userdata.img</span></pre> </li><li><pre> <span style="cursor: help">fastboot reboot</span></pre></li></ol><br><h2>TODO </h2> <ul> <li>TODO: Explain how to compile wlan.ko in order to enable wifi.  </li><li>TODO: Explain how to provide other <span style="cursor: help">kernel modules for a chroot debian install on the G1.  </span> </li><li>TODO: Explain how to compile the rest of CyanogenMod </li></ul> <div>Retrieved from "<a href="http://wiki.cyanogenmod.com/index.php/Building_from_source" target="_blank" rel="nofollow">http://wiki.cyanogenmod.com/index.php/Building_from_source</a>"</div> <div></div></div></div></div> 
    
                    </div>
                    
                    
                    
                    
                    
                    
                </div>
                
            </div>
            
        </div>
        
    </div>
    
    
    
    
    

</body></html>