<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0054)http://blog.chinaunix.net/uid-27406766-id-3409740.html -->
<html xmlns="http://www.w3.org/1999/xhtml" version="g42dymwpi--nx">
<body>
<div class="box">
  
  
   
  
  
  
    
  
  	 





  <div class="Blog_contain"> 
    
	

    
    <div class="Blog_right1">
      <div class="Blog_right1_1 Blog_right1_11">
        <div class="Blog_right1_2 ">
			<!--推荐博文-->
          
          <div class="Blog_con2">
            
           <div class="Blog_wz1" style="word-wrap: break-word;">
			<div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">使用BusyBox制作linux根文件系统（CramFS+mdev）</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">操作系统：Ubuntu9.04</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">内核版本：linux-2.6.24.7 &nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">开发板：博创arm2410s &nbsp; &nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">交叉编译工具：arm-linux-gcc-4.1.1&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">BusyBox：busybox-1.11.1 &nbsp; &nbsp; &nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">CramFS：CramFS-1.1</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">注意：由于要制作的根文件系统使用了mdev(BusyBox简化版的udev），因此，需要内 核支持sysfs、procfs和ramfs（tmpfs）文件系统以及hotplug（uevent）事件机制。</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">浅蓝色为命令，橘红色为 代码和脚步</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">1、准备根文件系统</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">使用shell脚本create_rootfs.sh，建立根文件系统的目录框架</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s$ vi create_rootfs.sh</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">create_rootfs.sh 内容如下：</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">#!/bin/sh</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">echo "------Create rootfs directons......"</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">mkdir rootfs</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">cd rootfs</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">echo "--------Create root,dev......"</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">mkdir root dev etc bin sbin mnt sys proc lib home tmp var usr</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">mkdir usr/sbin usr/bin usr/lib usr/modules</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">mkdir mnt/usb mnt/nfs mnt/etc mnt/etc/init.d</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">mkdir lib/modules</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">chmod 1777 tmp</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">cd ..</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">echo "-------make direction done---------"</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">为 create_rootfs.sh添加执行权限</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s$ chmod a+x create_rootfs.sh</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">执行create_rootfs.sh，建立根文件系统的目录框架</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s$ ./create_rootfs.sh</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s$ cd rootfs</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/rootfs$ ls</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">bin &nbsp;dev &nbsp;etc &nbsp;home &nbsp;lib &nbsp;mnt &nbsp;proc &nbsp;root &nbsp;sbin &nbsp;sys &nbsp;tmp &nbsp;usr &nbsp;var</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">2、创建设备 文件</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">mdev 是通过 init 进程来启动的，在使用 mdev 构造 /dev 目录之前，init 至少要用到设备文件/dev/console、/dev/null ，所以需要事先建立这两个设备文件:</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/rootfs$ cd dev</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/rootfs/dev$ sudo mknod -m 660 console c 204 64</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">[sudo] password for lingd:&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/rootfs/dev$ sudo mknod -m 660 null c 1 3</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/rootfs/dev$ ls -l</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">total 0</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">crw-rw---- 1 root root 5, 1 2010-04-02 15:49 console</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">crw-rw---- 1 root root 1, 3 2010-04-02 15:50 null</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">注意：本来console的主次设备号应为5和1.但是因为init在执行完/etc/init.d/rcS脚本后，就 会在一个控制台上，按照inittab的指示开一个shell（或者是开getty+login，这样用户就会看到提示输入用户名的提示符）。在mdev -s未执行之前，/dev目录下只有我们创建的/dev/null和/dev/console，也就是说，没有控制台可供init用来按照inittab 的指示开一个shell。而在s3c24xx 系列芯片的串口驱动里面用了s3c2410_serial做为设备名（在内核源码的“drivers/serial/s3c2410.c”文件的949 行），因此，启动时可用s3c2410_serial0、s3c2410_serial1或s3c2410_serial2作为init用来按照 inittab的指示开一个shell的控制台，这里我用了串口0，即s3c2410_serial0（主次设备号为204和64）作为控制台。这里直接 将console当s3c2410_serial0，所以console的主次设备号才会为204和64。</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">3、准备一些配置文件和系统启动时所需的文件</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">3.1、mdev配置文件mdev.conf</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">mdev 会在/etc目录下找mdev的配置文件: mdev.conf. 如果该文件不存在，那么在执行mdev –s这个命令时，会提示找不到mdev.conf。我们不需要mdev规则，所以只是touch生成一个空文件就OK了。当然也可以根据mdev的规则来 编写mdev.conf。我把所有配置文件都是在/mnt/etc下，而不是/etc，后面解释这么做的原因。</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/rootfs/dev$ cd ../mnt/etc</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/rootfs/mnt/etc$ touch mdev.conf</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/rootfs/mnt/etc$ ls</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">init.d &nbsp;mdev.conf</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">3.2、linuxrc</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">linuxrc 位于根文件系统的顶层目录/，这里为rootfs。/Linuxrc 执行init 进程初始化文件。主要工作是把已安装根文件系统中的/etc 安装为ramfs，并拷贝/mnt/etc/目录下所有文件到/etc，这里存放系统启动后的许多特殊文件；接着Linuxrc 重新构建文件分配表inittab；之后执行系统初始化进程/sbin/init。</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/rootfs/mnt/etc$ cd ../..</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/rootfs$ vi linuxrc</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">linuxrc 内容如下：</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">#!/bin/sh</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">echo "Processing /linuxrc"</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">echo "mount /etc as ramfs"</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">/bin/mount -n -t ramfs ramfs /etc &nbsp; &nbsp; &nbsp;&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">/bin/cp -a /mnt/etc/* /etc</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">echo "re-create the /etc/mtab entries"</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">/bin/mount -f -t cramfs -o remount,ro /dev/bon/3 /</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">/bin/mount -f -t ramfs ramfs /etc</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">echo "start init"</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">exec /sbin/init</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/rootfs$ ls</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">bin &nbsp;dev &nbsp;etc &nbsp;home &nbsp;lib &nbsp;linuxrc &nbsp;mnt &nbsp;proc &nbsp;root &nbsp;sbin &nbsp;sys &nbsp;tmp &nbsp;usr &nbsp;var</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">Linuxrc 脚本分析</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">/bin/mount -n -t ramfs ramfs /etc&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">这句话的作用加载一个ramfs作为/etc目录。这样 /etc就是一个可写目录。</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">从这个脚本可知，你的根文件系统是一个cramfs（只读文件系统），而/etc作为系统运行配置文件的存放地点，可 能会写一些运行状态在这里，linuxrc第一件事情就是将一个ramfs mount到/etc只读目录中，使得/etc/目录可写，指定参数 -n的目的是告诉mount不要写/etc/mtab, 这个文件存放当前系统已挂载（mount）的文件系统清单。因为现在/etc/目录还是只读，所以这次mount不要写这个文件，否则会失败。而且 mount上后，原/etc会覆盖掉（原/etc下的文件都不见了，umount后会重新出现），所以我们把配置文件都保存在/mnt /etc，mount上ramfs到/etc后，再把配置文件拷贝到/etc。而不是直接将配置文件保存在/etc/下</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp;/bin/cp -a /mnt/etc/* /etc</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">/etc成为可写目录后，将所有/mnt/etc中的配置文件拷贝到/etc/中，这说明ramfs可能 是一个空的ramfs，没有配置文件，或者配置文件比较老。同时也说明这个系统是一个只读系统，每次系统运行中写入的配置不会保留。</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">将以前 mount的那些信息重新写到/etc/mtab中，命令就是下面这些。</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">/bin/mount -f -t cramfs -o remount,ro /dev/bon/3 /</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">/bin/mount -f -t ramfs ramfs /etc</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">这些命令只是将这 些mount信息写到/etc/mtab中，不会实际去mount这些block device，说明你的根文件系统依然是以前的那个/dev/bon/3</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">exec /sbin/init</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">执行根文件系统中的init执行 程序，使其成为1号进程。shell正式运行。</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">3.3、rcS</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">rcS 文件位于/etc/init.d,是busybox版init第一个运行的脚步（常见的init还有Sys V init版，其第一个执行的脚步是/etc/rc.d/rc.sysinit)。/mnt/etc/init.d/rcS 完成各个文件系统的 mount，再执行/mnt/etc/rc.local；通过rcS 可以调用 ifconfig 程序配置网络。rcS 执行完了以后，init 就会在一个 console 上，按照 inittab 的指示开一个 shell，或者是开 getty + login，这样用户就会看到提示输入用户名的提示符。/etc/init.d/rcS文件内容如下：</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/rootfs$ cd mnt/etc/init.d</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/rootfs/mnt/etc/init.d$ vi rcS</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">/etc/init.d/rcS内容如下：</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">#!/bin/sh</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">echo "Processing /etc/init.d/rcS"</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">echo "mount -a"</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">mount -a #mount上fstab文件中所有文件系统</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">exec /etc/rc.local</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">3.4、/etc/rc.local&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">/etc/rc.local是被init.d/rcS 文件调用执行的特殊文件，与Linux 系统硬件平台相关，如安装核心模块、进行网络配置、运行应用程序、启动图形界面等。内容如下：</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/rootfs/mnt/etc/init.d$ cd ..</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/rootfs/mnt/etc$ vi rc.local</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">/etc/rc.local内容如下：</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">#!/bin/sh</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">echo "Processing /etc/rc.local"</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">echo "get hostname"</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">/bin/hostname -F /etc/hostname</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">echo "Starting mdev"</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">echo /sbin/mdev &gt; /proc/sys/kernel/hotplug</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">mdev -s</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">echo "ifconfig eth0 192.168.1.21"</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">ifconfig eth0 192.168.1.21</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">echo "**************************************************"</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">echo "* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*"</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">echo "* &nbsp; &nbsp; &nbsp; &nbsp;lingd &nbsp;rootfs for linux 2.6.24.7 &nbsp; &nbsp; &nbsp; &nbsp;*"</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">echo "* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*"</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">echo "* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;arm-linux-gcc version 4.1.1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *"</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">echo "* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*"</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">echo "* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2010-03-30 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *"</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">echo "* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*"</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">echo "**************************************************"</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/rootfs/mnt/etc$ ls</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">init.d &nbsp;rc.local</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">在rc.local使用了"/bin/hostname -F /etc/hostname"来设置主机名(设置主机名主要是为了后面设置命令提示符PS1)。这条命令需要了一个主机名配置文件/etc /hostname，其内容如下：</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">arm2410s</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">3.5、/etc/profile</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">rc.local 首先执行该文件配置应用程序需要的环境变量等。</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/rootfs/mnt/etc$ vi profile</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">/etc/profile内容如下：</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">#/etc/profile</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">echo "Processing /etc/profile"</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">echo "set user path"</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">PATH=/bin:/sbin:/usr/bin:/usr/sbin&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">echo "set search library path"</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">LD_LIBRARY_PATH=/lib:/usr/lib</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">echo "set PS1"</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">HOSTNAME=`/bin/hostname`</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">PS1='\u@\h:\w\$ ' ＃设置命令提示符为ubuntu风格</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">export PATH LD_LIBRARY_PATH HOSTNAME PS1</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/rootfs/mnt/etc$ ls</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">init.d &nbsp;profile &nbsp;rc.local</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">改变这四个文件的权限</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/rootfs/mnt/etc$ cd ../..</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/rootfs$ chmod 775 linuxrc mnt/etc/init.d/rcS mnt/etc/rc.local mnt/etc/profile</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">3.6、/etc/inittab</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">内核引导完成后，内核会启动初始化进程init（用户级进程）来进行 系统的各项配置。init是系统第一个进程，它是系统上运行的所有其他进程的父进程，他会观察其子进程，并在需要时启动、停止、重启它们。init主要是 用来完成系统的各项配置。init从/etc/inittab获取所有信息。想了解BusyBox init及其inittab基本原理的，可以看这篇文章http://blog.chinaunix.net/u3/109117/showart_2208026.html。lingd@ubuntu:~/arm2410s/rootfs$ cd mnt/etc</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/rootfs/mnt/etc$ vi inittab</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">/etc /inittab内容如下：</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">#/etc/inittab</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">::sysinit:/etc/init.d/rcS</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">console::askfirst:-/bin/sh &nbsp; &nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">::ctrlaltdel:/sbin/reboot</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">::shutdown:/bin/umount -a -r</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">"console::askfirst:-/bin/sh"中 的-表示的是让busybox开启一个登录(login)shell,login shell在执行前都会读取配置文件/etc/profile和.profile。由BusyBox源码的shell/ash.c文件可知 这一点：</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">int ash_main(int argc ATTRIBUTE_UNUSED, char **argv)</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">{</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; …………</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; if (argv[0] &amp;&amp; argv[0][0] == '-')</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp; &nbsp; isloginsh = 1;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; if (isloginsh) {</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp; &nbsp; state = 1;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp; &nbsp; read_profile("/etc/profile");</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">state1:</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp; &nbsp; state = 2;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp; &nbsp; read_profile(".profile");</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; …………</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">}</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">因为我们在/etc/profile对PATH、LD_LIBRARY_PATH、 HOSTNAME、PS1等环境变量进行了修改,所以BusyBox开启的必须是一个login shell（这样可以保证/profile的内容对开发板上所有shell都是有效的）；否则/etc/profile定义的内容将不会执行。</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">做 个小实验(以这次做好的根文件系统为基础)：</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">Please press Enter to activate this console. &nbsp; &nbsp; &nbsp; &nbsp; #启动开发板，引导linux内核并进行各系统配置后，执行到这里。按下回车键，显示以下内 容： &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">starting pid 797, tty '/dev/console': '-/bin/sh ' &nbsp; &nbsp;#在控制台/dev/console上开启一个login shell &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">Processing /etc/profile &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#执行/etc/profile配置文 件 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">set user path &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">set search library path &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">set PS1 &nbsp; &nbsp; &nbsp;&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">root@arm2410s:/# &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">root@arm2410s:/# exit &nbsp; &nbsp; #退出当前 shell &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">Please press Enter to activate this console. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#再按回车开启一个新的login shell &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">starting pid 799, tty '/dev/console': '-/bin/sh ' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">Processing /etc/profile &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #再次执行/etc/profile配置文 件 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">set user path &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">set search library path &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">set PS1&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/rootfs/mnt/etc$ ls</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">init.d &nbsp;inittab &nbsp;profile &nbsp;rc.local</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">3.7、/etc/fstab</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">文件/etc/fstab存放的是系统中的文件系统信息。当正确的设置了该 文件，则可以通过"mount /directoryname"命令来加载一个文件系统，或mount -a来加载该文件中所有文件系统。每种文件系统都对应一个独立的行，每行中的字段都有空格或tab键分开。同时fsck、mount、umount的等命 令都利用该程序。</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/rootfs/mnt/etc$ vi fstab</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">fstab文件内容如下：</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">#/etc/fstab: static file system information.</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">#&lt;File system&gt; &lt;mount pt&gt; &nbsp; &nbsp; &lt;type&gt; &nbsp; &lt;options&gt; &nbsp; &nbsp; &nbsp; &nbsp; &lt;dump&gt; &lt;pass&gt;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">proc &nbsp;/proc proc &nbsp;defaults 0 0</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">sysfs /sys &nbsp;sysfs defaults 0 0</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">mdev &nbsp;/dev &nbsp;ramfs defaults 0 0</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">none &nbsp;/tmp &nbsp;ramfs defaults 0 0</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">注意： 已单独mount了的文件系统，就不要出现在/etc/fstab文件中，以免使用mount -a时把先前已经mount上的文件系统被覆盖了。</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">3.8、/etc/passwd</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">/etc/passwd文件存放着所有用户的信息，包括账号和密码。内容如下：</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">#username:password:User ID:Group ID:comment:home directory:shell</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">root:x:0:0:root:/root:/bin/sh</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">4、编译busybox</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">BusyBox下载地址：http://www.busybox.net/</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s$ tar xjvf busy-1.11.1.tar.bz2</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s$ cd busybox-1.11.1</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/busybox-1.11.1$ vi Makefile</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">首先修改 Makefile ,将以下两项改为</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">CROSS_COMPILE = arm-linux-</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">ARCH &nbsp; &nbsp; &nbsp;= arm</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">配置busybox，修改以下选项（其他选项默认就可 以了，或者根据需要再裁减一下）：</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/busybox-1.11.1$ make menuconfig</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">Busybox Settings &nbsp;---&gt;&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">Build Options &nbsp;---&gt;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;[*] Build BusyBox as a static binary (no shared libs)</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;[ ] Build with Large File Support (for accessing files &gt; 2 GB)</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">Installation Options &nbsp;---&gt;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;[*] Don't use /usr &nbsp; &nbsp; &nbsp; &nbsp;#这项必选选上，否则BusyBox默认安装路径是/usr，原/usr下的东西可能会被覆盖了</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp; &nbsp; Applets links (as soft-links) &nbsp;---&gt;&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;(./_install) BusyBox installation prefix</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">Busybox Library Tuning &nbsp;---&gt;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;[*] Command line editing</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;(1024) Maximum length of input &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;[*] &nbsp; vi-style line editing commands &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;(15) &nbsp;History size &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;[*] &nbsp; History saving &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;[*] &nbsp; Tab completion &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;[*] &nbsp; &nbsp; Username completion &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;[*] &nbsp; Fancy shell prompts</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">这两项必须选上，不然BusyBox将无法识别环境变量PS1里的参数。</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">Linux Module Utilities &nbsp;---&gt;&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;[*] insmod &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;[*] &nbsp; Enable load map (-m) option &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;[*] &nbsp; &nbsp; Symbols in load map &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;[*] rmmod &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;[*] lsmod &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;[*] &nbsp; Pretty output for 2.6.x Linux kernels &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;[*] modprobe</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;[ ] &nbsp; Multiple options parsing &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;[ ] &nbsp; Fancy alias parsing &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;[ ] &nbsp; Blacklist support &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;--- &nbsp; Options common to multiple modutils &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;[ ] Support tainted module checking with new kernels &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;[ ] Support version 2.2.x to 2.4.x Linux kernels &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;[*] Support version 2.6.x Linux kernels &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;(/lib/modules) Default directory containing modules &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; &nbsp;(modules.dep) Default name of modules.dep&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">保存退出 Busybox</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/busybox-1.11.1$ make</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/busybox-1.11.1$ make install</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">编译BusyBox时，可能会出现以下错误：</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">4.1、inotifyd出错</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">交叉编译busybox－1.11.1时，出现以下错误：</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">CC &nbsp; &nbsp; &nbsp;miscutils/inotifyd.o</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">miscutils/inotifyd.c:31:27: linux/inotify.h: No such file or directory</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">miscutils/inotifyd.c: In function `inotifyd_main':</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">miscutils/inotifyd.c:61: error: `IN_ALL_EVENTS' undeclared (first use in this function)</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">miscutils/inotifyd.c:61: error: (Each undeclared identifier is reported only once</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">miscutils/inotifyd.c:61: error: for each function it appears in.)</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">miscutils/inotifyd.c:129: error: dereferencing pointer to incomplete type</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">miscutils/inotifyd.c:139: error: dereferencing pointer to incomplete type</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">miscutils/inotifyd.c:140: error: dereferencing pointer to incomplete type</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">miscutils/inotifyd.c:140: error: dereferencing pointer to incomplete type</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">miscutils/inotifyd.c:143: error: invalid application of `sizeof' to incomplete type `inotify_event'</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">miscutils/inotifyd.c:143: error: dereferencing pointer to incomplete type</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">make[1]: *** [miscutils/inotifyd.o] Error 1</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">make: *** [miscutils] Error 2&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">网上说这是busybox的一个bug，解决方法：去掉对inotifyed的支持，具体步骤如下：</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">＃ make menuconfig</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">Miscellaneous Utilities &nbsp;---&gt;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; [ ]inotifyd</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">还有另一个bug是 taskset，也要将它去掉，不然编译时又会出错。</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">Miscellaneous Utilities &nbsp;---&gt;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; [ ]taskset</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">4.2、启动时，BusyBox提示"/bin/sh:can't access tty;job console turn off"</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">解决方法：</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">shell &nbsp;---&gt;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; [ ]Job Console</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">&nbsp; &nbsp; [*]Cttyhack &nbsp; &nbsp; &nbsp;&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">4.3、未定义 ARPHRD_INFINIBAND</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">错误信息如下：</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">networking/interface.c:818: error: 'ARPHRD_INFINIBAND' undeclared here (not in a function)</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">make[1]: *** [networking/interface.o] Error 1</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">make: *** [networking] Error 2</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">通过查看内核源代码目录中的“include/linux/ifarp.h”文件可知 “ARPHRD_INFINIBAND”的值为“32”。然后修改“networking/interface.c”文件，在其中添加：</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">#define ARPHRD_INFINIBAND 32 &nbsp;/* InfiniBand */</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">默认在_install目录中生成基本的文件系统, 包括以下目录或文件bin、sbin、linuxrc该目录下包含了基本的 shell 命令.将编译好的BusyBox的_Install目录下的bin和sbin用tar命令打包复制到~/rootfs目录，解压后删除打包文件。</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/busybox-1.11.1$ cd _install</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/busybox-1.11.1/_install$ ls</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">bin &nbsp;linuxrc &nbsp;sbin</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/busybox-1.11.1/_install$ tar zcvf rootfs.tar.gz bin sbin</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/busybox-1.11.1/_install$ ls</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">bin &nbsp;linuxrc &nbsp;rootfs.tar.gz &nbsp;sbin</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/busybox-1.11.1/_install$ mv rootfs.tar.gz ../../rootfs</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/busybox-1.11.1/_install$ ls</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">bin &nbsp;linuxrc &nbsp;sbin</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/busybox-1.11.1/_install$ cd ../../rootfs</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/rootfs$ ls</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">bin &nbsp;etc &nbsp; lib &nbsp; &nbsp; &nbsp;mnt &nbsp; root &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sbin &nbsp;tmp &nbsp;var</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">dev &nbsp;home &nbsp;linuxrc &nbsp;proc &nbsp;rootfs.tar.gz &nbsp;sys &nbsp; usr</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/rootfs$ tar zvxf rootfs.tar.gz</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/rootfs$ rm rootfs.tar.gz</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">5、 lib库文件复制到rootfs/lib目录下（根据需要复制）</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/rootfs$ cd /opt/crosstool/gcc-4.1.1-glibc-2.3.2/arm-linux/arm-linux/lib</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:/opt/crosstool/gcc-4.1.1-glibc-2.3.2/arm-linux/arm-linux/lib$ cp -dR ld* ~/arm2410s/rootfs/lib</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:/opt/crosstool/gcc-4.1.1-glibc-2.3.2/arm-linux/arm-linux/lib$ cp -dR libc*.so* ~/arm2410s/rootfs/lib</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:/opt/crosstool/gcc-4.1.1-glibc-2.3.2/arm-linux/arm-linux/lib$ cp -dR libcrypt* ~/arm2410s/rootfs/lib</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:/opt/crosstool/gcc-4.1.1-glibc-2.3.2/arm-linux/arm-linux/lib$ cp -dR libgcc_s.so* ~/arm2410s/rootfs/lib</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:/opt/crosstool/gcc-4.1.1-glibc-2.3.2/arm-linux/arm-linux/lib$ cp -dR libm* ~/arm2410s/rootfs/lib</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:/opt/crosstool/gcc-4.1.1-glibc-2.3.2/arm-linux/arm-linux/lib$ cp -dR libpthread.so* ~/arm2410s/rootfs/lib</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">6、生成 CramFS文件系统镜像文件CramFS.img</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">首先从http://sourceforge.net/projects/cramfs/下载 cramfs-1.1.tar.gz</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:/opt/crosstool/gcc-4.1.1-glibc-2.3.2/arm-linux/arm-linux/lib$ cd ~/arm2410s</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s$ tar zxvf cramfs-1.1.tar.gz</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s$ cd cramfs-1.1</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/cramfs-1.1$ ls</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">COPYING &nbsp;cramfsck.c &nbsp;GNUmakefile &nbsp;linux &nbsp;mkcramfs.c &nbsp;NOTES &nbsp;README</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/cramfs-1.1$ make</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">gcc -W -Wall -O2 -g -I. &nbsp; mkcramfs.c &nbsp;-lz -o mkcramfs</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">gcc -W -Wall -O2 -g -I. &nbsp; cramfsck.c &nbsp;-lz -o cramfsck</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">在 cramfs-1.1目录下会出现两个bin文件mkcramfs和cramfsck</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/cramfs-1.1$ ls</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">COPYING &nbsp; cramfsck.c &nbsp; linux &nbsp; &nbsp; mkcramfs.c &nbsp;README</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">cramfsck &nbsp;GNUmakefile &nbsp;mkcramfs &nbsp;NOTES</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">把他们copy到/usr/bin:&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/cramfs-1.1$ sudo cp mkcramfs cramfsck /usr/bin</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">创建根文件系统的cramfs镜像</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/cramfs-1.1$ mkcramfs ../rootfs CramFS01.img</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">Directory data: 6020 bytes</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">Everything: 908 kilobytes</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">Super block: 76 bytes</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">CRC: 526c6bb5</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">warning: gids truncated to 8 bits (this may be a security concern)</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/cramfs-1.1$ ls</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">COPYING &nbsp; &nbsp; &nbsp; cramfsck &nbsp; &nbsp;GNUmakefile &nbsp;mkcramfs &nbsp; &nbsp;NOTES</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">CramFS01.img &nbsp;cramfsck.c &nbsp;linux &nbsp; &nbsp; &nbsp; &nbsp;mkcramfs.c &nbsp;README</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">测试一下刚生成的CramFS01.img：</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/cramfs-1.1$ sudo mount -o loop -t cramfs ~/CramFS01.img /mnt/usb</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">lingd@ubuntu:~/arm2410s/cramfs-1.1$ ls /mnt/usb</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">查 看是否有bin、etc等目录</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">编译cramfs时出现如下错误：</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">mkcramfs.c:37:18: zlib.h: No such file or directory</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">mkcramfs.c: In function `write_superblock':</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">mkcramfs.c:392: warning: implicit declaration of function `crc32'</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">mkcramfs.c:392: error: `Z_NULL' undeclared (first use in this function)</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">mkcramfs.c:392: error: (Each undeclared identifier is reported only once</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">mkcramfs.c:392: error: for each function it appears in.)</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">mkcramfs.c: In function `do_compress':</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">mkcramfs.c:598: warning: implicit declaration of function `compress2'</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">mkcramfs.c:598: error: `Z_BEST_COMPRESSION' undeclared (first use in this function)</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">mkcramfs.c:599: error: `Z_OK' undeclared (first use in this function)</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">mkcramfs.c:600: warning: implicit declaration of function `zError'</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">mkcramfs.c: In function `main':</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">mkcramfs.c:824: error: `Z_NULL' undeclared (first use in this function)</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">make: *** [mkcramfs] Error 1</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">原因没安装 zlib-devel包</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">在ubuntu软件源里zlib和zlib-devel叫做zlib1g zlib1g.dev</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">$ sudo apt-get install zlib1g</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">$ sudo apt-get install zlib1g.dev</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;"><br></span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">参考文章</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">ARM嵌入式Linux系统开发技术详解 杨水清、张剑、施云飞等编著</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">使 用mdev制作cramfs根文件系统&nbsp;</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">http://hi.baidu.com/kkernel/blog/item/cf2d6845b917e836879473b3.html</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">飞 凌OK-2440-III文件系统移植-------busybox+mdev</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">http://bbs.21ic.com/icview-155436-1-1.html</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">s3c2410 平台linux2.6.22内核的文件系统移植总结</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">http://hi.baidu.com/hzau_wall_e/blog/item/76258afb58b6b5819e5146cc.html/cmtid/d4e418ee679a101cfdfa3cd4</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">linuxrc 详解</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">http://blog.chinaunix.net/u1/38576/showart_444508.html</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">详解 Linuxrc、rcS、rc.local、Profile</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">http://hi.baidu.com/wangy0919/blog/item/1e0bc18fd27f86f8513d92fb.html</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">使 用Busybox制作CRAMFS文件系统成功</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">http://linux.chinaunix.net/techdoc/system/2008/08/20/1026770.shtml</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">关于根文件系统中命令行提示符的显示</span></font></div><div><font face="Arial, Helvetica, sans-serif" size="4"><span style="line-height: 33.981483459472656px;">http://www.eefocus.com/ayayayaya/blog/10-01/183654_4d808.html</span></font></div>           </div>
            
            
            
          </div>
          
		  
        </div>
      </div>
      
    </div>
  </div>
  




  
  
</div>








</body></html>